# TCP

## 기본 개념

1. TCP는 **신뢰성 있는 전송**을 보장하는 **연결 지향형 프로토콜**이다.
2. 데이터를 **순서대로 전달**하며, **손실, 중복, 순서 뒤바뀜** 등을 제어한다.
3. IP는 \*\*비신뢰성(best effort)\*\*이기 때문에, TCP가 그 위에서 **신뢰성을 보장**한다.


## 주요 특징

1. **연결 지향 (Connection-oriented)**

   * `3-way handshake`로 연결 설정
   * `4-way handshake`로 연결 종료

2. **신뢰성 보장**

   * 손실 시 재전송, 중복 제거, 순서 보장, 에러 검출

3. **흐름 제어 (Flow Control)**

   * 수신 측 버퍼에 맞춰 전송 속도 조절
   * **슬라이딩 윈도우** 방식 사용

4. **혼잡 제어 (Congestion Control)**

   * 네트워크 혼잡 시 전송 속도 조절
   * 알고리즘: Slow Start, Congestion Avoidance, Fast Retransmit, Fast Recovery

## TCP 헤더 구조

| 필드                    | 설명                                |
| ----------------------- | ----------------------------------- |
| Source/Destination Port | 송수신 포트 번호                    |
| Sequence Number         | 데이터 순서 지정                    |
| Acknowledgment Number   | 수신 측이 기대하는 다음 시퀀스 번호 |
| Data Offset             | TCP 헤더 길이 (옵션 포함)           |
| Flags                   | SYN, ACK, FIN, RST 등 제어 플래그   |
| Window Size             | 수신 가능한 데이터 양 (흐름 제어)   |
| Checksum                | 오류 검출                           |
| Urgent Pointer          | 긴급 데이터 처리용                  |
| Options                 | MSS, 윈도우 스케일링, 타임스탬프 등 |


## 연결 절차

### 1. 연결 설정 (3-way handshake)

1. 클라이언트 → 서버 : `SYN` 전송
2. 서버 → 클라이언트 : `SYN + ACK` 전송
3. 클라이언트 → 서버 : `ACK` 전송 → 연결 성립

### 2. 연결 종료 (4-way handshake)

1. 클라이언트 → 서버 : `FIN` 전송
2. 서버 → 클라이언트 : `ACK` 전송
3. 서버 → 클라이언트 : `FIN` 전송
4. 클라이언트 → 서버 : `ACK` 전송 → 연결 종료


## TCP vs UDP

| 항목      | TCP                         | UDP                    |
| --------- | --------------------------- | ---------------------- |
| 연결 방식 | 연결 지향                   | 비연결 지향            |
| 신뢰성    | 보장 (재전송, 순서 보장 등) | 보장 안 됨             |
| 속도      | 느림                        | 빠름                   |
| 사용 예시 | HTTP, FTP, SSH, SMTP 등     | DNS, VoIP, 스트리밍 등 |


## TCP 계층 위치 (OSI 7계층 기준)

| 계층 번호 | 계층 이름        | 관련 프로토콜 예시      |
| --------- | ---------------- | ----------------------- |
| 7         | 응용 계층        | HTTP, FTP, SMTP         |
| 6         | 표현 계층        | (데이터 변환/암호화 등) |
| 5         | 세션 계층        | (세션 관리 등)          |
| **4**     | **전송 계층**    | **TCP**, UDP            |
| 3         | 네트워크 계층    | IP, ICMP, ARP           |
| 2         | 데이터 링크 계층 | Ethernet, PPP           |
| 1         | 물리 계층        | 전기 신호, 케이블 등    |


## TCP 전송 계층의 주요 기능

1. **포트 번호 기반 통신**

   * 애플리케이션 간의 연결 식별 및 구분

2. **신뢰성 보장**

   * 재전송, 순서 보장, 오류 검출, 흐름/혼잡 제어

3. **스트림 전송 지원**

   * 바이트 단위로 연속된 데이터 흐름 제공


## 사용 예시

* **웹 브라우징**: HTTP, HTTPS
* **파일 전송**: FTP, SCP
* **원격 접속**: SSH, Telnet
* **이메일 전송**: SMTP, POP3, IMAP

